flowchart TD
    Start([Lift Emergency SMS]) --> CreateTicket[Create Ticket with Reference<br/>e.g. BUILDING-TKT123]
    CreateTicket --> SendInitial[Send WhatsApp to All Contacts<br/>Test | Maintenance | Entrapment]
    
    SendInitial --> Wait1{Response<br/>within<br/>5 min?}
    
    Wait1 -->|Test| CloseTest[Close as Test<br/>Notify all contacts]
    Wait1 -->|Maintenance| CloseMaint[Close as Maintenance<br/>Notify all contacts]
    Wait1 -->|Entrapment| EntrapFlow[Start Entrapment Flow]
    Wait1 -->|No Response| Rem1[Send Reminder 1/3<br/>All 3 buttons]
    
    Rem1 --> Wait2{Response<br/>within<br/>5 min?}
    Wait2 -->|Any Button| Process1[Process Response]
    Wait2 -->|No Response| Rem2[Send Reminder 2/3<br/>All 3 buttons]
    
    Rem2 --> Wait3{Response<br/>within<br/>5 min?}
    Wait3 -->|Any Button| Process2[Process Response]
    Wait3 -->|No Response| Rem3[Send Reminder 3/3<br/>All 3 buttons]
    
    Rem3 --> Wait4{Response<br/>within<br/>5 min?}
    Wait4 -->|Any Button| Process3[Process Response]
    Wait4 -->|No Response| AutoClose[Auto-Close Ticket<br/>CRITICAL ALERT to all contacts]
    
    EntrapFlow --> SendConfirm[Send Confirmation Request<br/>YES button only]
    SendConfirm --> WaitYes1{YES<br/>within<br/>5 min?}
    
    WaitYes1 -->|YES| Confirmed[Service Provider Confirmed<br/>Close ticket, notify all]
    WaitYes1 -->|No Response| RemYes1[Send Reminder 1/3<br/>YES button]
    
    RemYes1 --> WaitYes2{YES<br/>within<br/>5 min?}
    WaitYes2 -->|YES| Confirmed
    WaitYes2 -->|No Response| RemYes2[Send Reminder 2/3<br/>YES button]
    
    RemYes2 --> WaitYes3{YES<br/>within<br/>5 min?}
    WaitYes3 -->|YES| Confirmed
    WaitYes3 -->|No Response| RemYes3[Send Reminder 3/3<br/>YES button]
    
    RemYes3 --> WaitYes4{YES<br/>within<br/>5 min?}
    WaitYes4 -->|YES| Confirmed
    WaitYes4 -->|No Response| AutoCloseEntrap[Auto-Close Ticket<br/>Alert: Follow up required]
    
    CloseTest --> End([Ticket Closed])
    CloseMaint --> End
    Process1 --> End
    Process2 --> End
    Process3 --> End
    AutoClose --> End
    Confirmed --> End
    AutoCloseEntrap --> End
    
    style Start fill:#ff6b6b
    style CreateTicket fill:#4ecdc4
    style SendInitial fill:#ffe66d
    style EntrapFlow fill:#ff6b6b
    style AutoClose fill:#ff0000,color:#fff
    style AutoCloseEntrap fill:#ff0000,color:#fff
    style Confirmed fill:#95e1d3
    style End fill:#95e1d3
